---
layout: solution
category: TryHackMe
contest_code: Advanced_Exploitation
contest_name: Advanced Exploitation
problem_code: HACKPARK
problem_name: HackPark
comments: false
tags: web windows
date: 2021-12-06
---

### A simple nmap scan was conducted on the machine. Turns out it is running a website

![Image](https://raw.githubusercontent.com/DJShankyShoe/Website/master/assets/Platforms/TryHackMe/HackPark/nmap.png)

‎


### We found out that there is a login page

![Image](https://raw.githubusercontent.com/DJShankyShoe/Website/master/assets/Platforms/TryHackMe/HackPark/index.png)

![Image](https://raw.githubusercontent.com/DJShankyShoe/Website/master/assets/Platforms/TryHackMe/HackPark/login.png)

‎


### We can determine a valid username by clicking on "Forgot your password?". If entered invalid usernames, we get "user not found" error

![Image](https://raw.githubusercontent.com/DJShankyShoe/Website/master/assets/Platforms/TryHackMe/HackPark/incorrect.png)

<p style="color:orange;">However, if we tried a valid username, we get some connection issue. Thus a valid username is "admin"</p>

![Image](https://raw.githubusercontent.com/DJShankyShoe/Website/master/assets/Platforms/TryHackMe/HackPark/correct.png)

‎


### Hydra is used to retrieve the credentials of the login page with the help of dictionary attack

![Image](https://raw.githubusercontent.com/DJShankyShoe/Website/master/assets/Platforms/TryHackMe/HackPark/network.png)

![Image](https://raw.githubusercontent.com/DJShankyShoe/Website/master/assets/Platforms/TryHackMe/HackPark/hydra.png)
```
hydra -l admin -P /usr/share/wordlists/rockyou.txt 10.10.19.225 -t 64 -e s http-post-form "/Account/login.aspx?ReturnURL=%2fadmin%2f:__VIEWSTATE=OwMLj62nFddvDy0oKG0%2BZCn80k5OFWl6%2Fir%2B1JesYoPTidABourkSGmHPuCzOPa47eSYdw8fhnuY086nn5Ld7D71lIEJz21IqyA0ijoJ2eXBticuw9W8PnwYE7SAzkWthFlrL%2Bo%2FQjmh854kKMjhjwODZhY2Wf1aCualDW8Y3fLKqGdiAJ8LQzlshMk6rhHBSELWMzb%2F40P6iYG3lg6lr8eEkKNTG8VzoHNFhq5cYfhY9c2KbeTHcLNWQch58rQO4O5%2BOoFwE5CzIwzQ7kR0AsTjdtjGT%2BqSEQMGv86ZtYQ0PdqpgZoe0hb2Pl8a4TbsTTDhHXTxSqO9qaX5gRDJDp7jOLe2AKYRmIRt4IFjKAEGlU0%2F&__EVENTVALIDATION=5V3E4WZs6LmcgVrwweKNSdSEatnmRRtFQG5pMUHgM976sggLsiEdsJp%2BYABlrlhlNGbnOwWC8s0QSaqj0dxCnf0bgswZwaawjxgcOBqUOW8CliINgCPDBhk7CZ83rF%2FZvhjK0zmSoZGPxRhlgt0GjE%2BV39LgJwu2Ogf2SzOp%2BgRmHY7f&ctl00%24MainContent%24LoginUser%24UserName=admin&ctl00%24MainContent%24LoginUser%24Password=^PASS^&ctl00%24MainContent%24LoginUser%24LoginButton=Log+in:Login failed"
```

‎


### We are then able to log into the webpage using he obtained creds. In the about page we are able to see this system information. After searching up for this version number, I found out that it is vulnerable to directory traversal. 
[Exploit DB 46353](https://www.exploit-db.com/exploits/46353)

![Image](https://raw.githubusercontent.com/DJShankyShoe/Website/master/assets/Platforms/TryHackMe/HackPark/about.png)

![Image](https://raw.githubusercontent.com/DJShankyShoe/Website/master/assets/Platforms/TryHackMe/HackPark/exploitdb.png)

‎


### To exploit this, we need to download the exploit code (reverse shell) from exploit-db. We then have to change the destination IP to our host machine and finally start a Ncat listener 

![Image](https://raw.githubusercontent.com/DJShankyShoe/Website/master/assets/Platforms/TryHackMe/HackPark/rce.png)

![Image](https://raw.githubusercontent.com/DJShankyShoe/Website/master/assets/Platforms/TryHackMe/HackPark/ncat.png)

<p style="color:orange;">The reverse shell to be uploaded as PostView.ascx in the specified mentioned URL</p>
`http://10.10.19.225/admin/app/editor/editpost.cshtml`

![Image](https://raw.githubusercontent.com/DJShankyShoe/Website/master/assets/Platforms/TryHackMe/HackPark/upload.png)

<p style="color:orange;">And then the script is executed by calling the following URL and a reverse shell is obtained on the ncat listener</p>
`http://10.10.19.225/?theme=../../App_Data/files`

![Image](https://raw.githubusercontent.com/DJShankyShoe/Website/master/assets/Platforms/TryHackMe/HackPark/url.png)

‎


### However this shell I just got is very crappy. So I decided to upgrade my shell to a meterpreter shell by first creating a msf payload and then uploading it over before executing it

![Image](https://raw.githubusercontent.com/DJShankyShoe/Website/master/assets/Platforms/TryHackMe/HackPark/shell.png)

![Image](https://raw.githubusercontent.com/DJShankyShoe/Website/master/assets/Platforms/TryHackMe/HackPark/msfvenom.png)

<p style="color:orange;">Started Webserver host for payload:</p>

![Image](https://raw.githubusercontent.com/DJShankyShoe/Website/master/assets/Platforms/TryHackMe/HackPark/metasploit.png)

<p style="color:orange;">Transferred & executed the payload over and retrieved a meterpreter shell:</p>

![Image](https://raw.githubusercontent.com/DJShankyShoe/Website/master/assets/Platforms/TryHackMe/HackPark/http_server.png)

![Image](https://raw.githubusercontent.com/DJShankyShoe/Website/master/assets/Platforms/TryHackMe/HackPark/meterpreter.png)

‎


### Uploaded winpeas to perform enumeration

![Image](https://raw.githubusercontent.com/DJShankyShoe/Website/master/assets/Platforms/TryHackMe/HackPark/meter_shell.png)

‎


### From the enumeration, we can see that the path `C:\Program Files (x86)\SystemScheduler` is writable. Take note that is where all the scheduled events are running and similar to cronjob on Linux
### So what we can do is see which applications are scheduled. This can be done by taking look at the event logs

![Image](https://raw.githubusercontent.com/DJShankyShoe/Website/master/assets/Platforms/TryHackMe/HackPark/winpeas.png)

![Image](https://raw.githubusercontent.com/DJShankyShoe/Website/master/assets/Platforms/TryHackMe/HackPark/schedular.png)

‎


###  From the events logs we are able to see that application Message.exe is being executed and killed every 30s with Administrative rights. So we can attempt to replace this original file with a the meterpreter shell

<p style="color:orange;">Viewing Logs:</p>

![Image](https://raw.githubusercontent.com/DJShankyShoe/Website/master/assets/Platforms/TryHackMe/HackPark/events.png)

<p style="color:orange;">Replacing Files:</p>

![Image](https://raw.githubusercontent.com/DJShankyShoe/Website/master/assets/Platforms/TryHackMe/HackPark/replace.png)

<p style="color:orange;">Flag:</p>

![Image](https://raw.githubusercontent.com/DJShankyShoe/Website/master/assets/Platforms/TryHackMe/HackPark/flag.png)